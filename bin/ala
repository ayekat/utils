#!/usr/bin/env sh
# Download old Arch Linux packages from the archive.

set -e

if [ -z "$1" ]; then
	echo 'Please specify a package name' >&2
	exit 1
fi
if [ -z "$2" ]; then
	echo 'Please specify a version' >&2
	exit 1
fi
initname="$(echo "$1" | cut -c 1)"

protocol='https'
host='archive.archlinux.org'
path='packages'
suffix='pkg.tar.xz'

arch="$(uname -m)"

for a in $arch 'any'; do
	if curl -f -O "$protocol://$host/$path/$initname/$1/$1-$2-$a.$suffix"; then
		exit 0
	fi
done
echo "Failed to obtain package \`$1-$2' from $host" >&2
exit 2
